# üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º: –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

## ‚ùå –û—à–∏–±–∫–∞: 401 Unauthorized - Wrong API Key

### –°–∏–º–ø—Ç–æ–º—ã

–í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–∞ –æ—à–∏–±–∫–∞:

```
[ERROR] [YandexSTT] Yandex STT API error: 401 -
{"error_code":"UNAUTHORIZED","error_message":"rpc error: code = Unauthenticated desc = Unknown api key 'gsk_****' (E9551C02)"}
```

–ö–ª—é—á –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `gsk_` (Groq API key).

### –ü—Ä–∏—á–∏–Ω–∞

–ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Groq API –∫–ª—é—á** –≤–º–µ—Å—Ç–æ **Yandex API –∫–ª—é—á–∞** –¥–ª—è SpeechKit.

–≠—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –∫–æ–≥–¥–∞:

- `AI_PROVIDER=groq` (–∏–ª–∏ –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä, –Ω–µ yandexgpt)
- `YANDEX_API_KEY` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –†–µ—à–µ–Ω–∏–µ

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–õ–æ–∫–∞–ª—å–Ω–æ** (`.env` —Ñ–∞–π–ª):

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
YANDEX_API_KEY=AQVNxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
YANDEX_FOLDER_ID=b1gxxxxxxxxxxxxxx

# –ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–π
AI_PROVIDER=groq
GROQ_API_KEY=gsk_xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**–ù–∞ Vercel** (Environment Variables):

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Vercel Dashboard](https://vercel.com/dashboard)
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç ‚Üí Settings ‚Üí Environment Variables
3. –î–æ–±–∞–≤—å—Ç–µ/–ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   - `YANDEX_API_KEY` = –≤–∞—à Yandex API –∫–ª—é—á
   - `YANDEX_FOLDER_ID` = –≤–∞—à Folder ID

#### 2. –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏

**Yandex API Key:**

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [console.cloud.yandex.ru](https://console.cloud.yandex.ru/)
2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç:
   - "–°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã" ‚Üí "–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç"
   - –ù–∞–∑–Ω–∞—á—å—Ç–µ —Ä–æ–ª–∏:
     - `ai.languageModels.user` (–¥–ª—è YandexGPT)
     - `ai.speechkit-stt.user` (–¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏)
3. –°–æ–∑–¥–∞–π—Ç–µ API-–∫–ª—é—á –¥–ª—è —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `AQVNxxx...` –∏–ª–∏ `AQVN...`)

**Yandex Folder ID:**

1. –í Yandex Cloud Console –æ—Ç–∫—Ä–æ–π—Ç–µ –Ω—É–∂–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥
2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID –∏–∑ URL –∏–ª–∏ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–∞—Ç–∞–ª–æ–≥–∞
3. –§–æ—Ä–º–∞—Ç: `b1gxxxxxxxxxxxxxx`

#### 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞

**–õ–æ–∫–∞–ª—å–Ω–æ:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞ (Ctrl+C)
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env | grep YANDEX

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
npm run dev
```

**–ù–∞ Vercel:**

```bash
# –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ Vercel Dashboard
vercel env pull

# –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–¥–µ–ø–ª–æ–π—Ç–µ
git commit --allow-empty -m "chore: redeploy"
git push origin main
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ –ª–æ–≥–∏

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å:

```
[INFO] [YandexSTT] Recognizing speech (size: XXXXX bytes)...
[INFO] [YandexSTT] Speech recognized: "–≤–∞—à —Ç–µ–∫—Å—Ç"
```

–í–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ 401.

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –±–æ—Ç–∞

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–æ—Ç—É:

```
üé§ "–¢–µ—Å—Ç"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**

```
üé§ –°–ª—É—à–∞—é –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...
üîç –†–∞—Å–ø–æ–∑–Ω–∞—é –≤–∞—à—É —Ä–µ—á—å...
üìù –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: "—Ç–µ—Å—Ç"
üí° –ì–µ–Ω–µ—Ä–∏—Ä—É—é –±–∏–∑–Ω–µ—Å-–∏–¥–µ—é...
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**

```
‚ùå –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã: –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã Yandex API –∫–ª—é—á–∏.
```

---

## ‚ùå –î—Ä—É–≥–∏–µ —á–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏

### –û—à–∏–±–∫–∞: "YANDEX_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤—å—Ç–µ –≤ .env
echo "YANDEX_API_KEY=your_key_here" >> .env

# Vercel: –¥–æ–±–∞–≤—å—Ç–µ —á–µ—Ä–µ–∑ Dashboard –∏–ª–∏ CLI
vercel env add YANDEX_API_KEY
```

### –û—à–∏–±–∫–∞: 403 Forbidden

**–ü—Ä–∏—á–∏–Ω–∞:** –£ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ SpeechKit

**–†–µ—à–µ–Ω–∏–µ:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ [console.cloud.yandex.ru](https://console.cloud.yandex.ru/)
2. –°–µ—Ä–≤–∏—Å–Ω—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
3. –î–æ–±–∞–≤—å—Ç–µ —Ä–æ–ª—å: `ai.speechkit-stt.user`
4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ API –∫–ª—é—á (—Å—Ç–∞—Ä—ã–π –º–æ–∂–µ—Ç –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç—å –Ω–æ–≤—ã–µ –ø—Ä–∞–≤–∞)

### –û—à–∏–±–∫–∞: 429 Too Many Requests

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç 1000 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–µ—Å—è—Ü

**–†–µ—à–µ–Ω–∏–µ:**

- –ü–æ–¥–æ–∂–¥–∏—Ç–µ –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –º–µ—Å—è—Ü–∞ (–ª–∏–º–∏—Ç —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è)
- –ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ Yandex Cloud

### –û—à–∏–±–∫–∞: "–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å —Ä–µ—á—å"

**–ü—Ä–∏—á–∏–Ω—ã:**

- –ü–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞
- –°–ª–∏—à–∫–æ–º —Ç–∏—Ö–∞—è –∑–∞–ø–∏—Å—å
- –®—É–º –Ω–∞ —Ñ–æ–Ω–µ

**–†–µ—à–µ–Ω–∏–µ:**

- –ó–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç–∏—Ö–æ–º –º–µ—Å—Ç–µ
- –ì–æ–≤–æ—Ä–∏—Ç–µ —á—ë—Ç–∫–æ –∏ –≥—Ä–æ–º–∫–æ
- –î–µ—Ä–∂–∏—Ç–µ —Ç–µ–ª–µ—Ñ–æ–Ω –±–ª–∏–∑–∫–æ –∫–æ —Ä—Ç—É (10-15 —Å–º)

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–µ–π –≤—Ä—É—á–Ω—É—é

**YandexGPT:**

```bash
curl -X POST \
  https://llm.api.cloud.yandex.net/foundationModels/v1/completion \
  -H "Authorization: Api-Key $YANDEX_API_KEY" \
  -H "x-folder-id: $YANDEX_FOLDER_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "modelUri": "gpt://'$YANDEX_FOLDER_ID'/yandexgpt-lite",
    "completionOptions": {"stream": false, "maxTokens": "100"},
    "messages": [{"role": "user", "text": "test"}]
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** JSON —Å –æ—Ç–≤–µ—Ç–æ–º  
**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–ª—é—á –∏ folder ID

**SpeechKit (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞—É–¥–∏–æ—Ñ–∞–π–ª):**

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π OGG —Ñ–∞–π–ª –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
curl -X POST \
  "https://stt.api.cloud.yandex.net/speech/v1/stt:recognize?lang=ru-RU&folderId=$YANDEX_FOLDER_ID" \
  -H "Authorization: Api-Key $YANDEX_API_KEY" \
  --data-binary "@test.ogg"
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

–î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:

```typescript
// src/handlers/voice.handler.ts

console.log("=== Voice Handler Debug ===");
console.log("YANDEX_API_KEY exists:", !!config.yandexApiKey);
console.log("YANDEX_API_KEY length:", config.yandexApiKey?.length);
console.log(
  "YANDEX_API_KEY starts with:",
  config.yandexApiKey?.substring(0, 4)
);
console.log("YANDEX_FOLDER_ID:", config.yandexFolderId);
```

**–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥:**

```
YANDEX_API_KEY exists: true
YANDEX_API_KEY length: 54 (–ø—Ä–∏–º–µ—Ä–Ω–æ)
YANDEX_API_KEY starts with: AQVN
YANDEX_FOLDER_ID: b1gxxxxxx
```

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–≤–æ–¥:**

```
YANDEX_API_KEY starts with: gsk_  ‚Üê –≠—Ç–æ Groq –∫–ª—é—á!
```

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Yandex Cloud Console](https://console.cloud.yandex.ru/)
- [Yandex SpeechKit Docs](https://cloud.yandex.ru/docs/speechkit/)
- [–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](docs/VOICE_RECOGNITION.md)

---

## üí¨ –ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å?

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ (Yandex, –Ω–µ Groq/Gemini)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É `/contact` –≤ –±–æ—Ç–µ –¥–ª—è —Å–≤—è–∑–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π

---

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ!** üéâ

–¢–µ–ø–µ—Ä—å –±–æ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Yandex API –∫–ª—é—á –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥–µ–π.
